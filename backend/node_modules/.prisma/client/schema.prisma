// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  STUDENT
  ADMIN
}

enum Difficulty {
  Easy
  Medium
  Hard
}

enum SubmissionStatus {
  PENDING
  PASS
  FAIL
  ERROR
}

model User {
  id                   String    @id @default(uuid())
  name                 String
  email                String?   @unique
  roll_number          String?   @unique
  password_hash        String
  role                 Role      @default(STUDENT)
  must_change_password Boolean   @default(true)
  failed_attempts      Int       @default(0)
  locked_until         DateTime?
  created_at           DateTime  @default(now())

  submissions    Submission[]
  suspiciousLogs SuspiciousLog[]
}

model Problem {
  id          String     @id @default(uuid())
  title       String
  description String
  difficulty  Difficulty
  tags        String[]
  created_by  String
  created_at  DateTime   @default(now())

  testCases   TestCase[]
  submissions Submission[]
}

model TestCase {
  id              String  @id @default(uuid())
  problem_id      String
  input           String
  expected_output String
  is_hidden       Boolean @default(false)

  problem Problem @relation(fields: [problem_id], references: [id], onDelete: Cascade)
}

model Submission {
  id             String           @id @default(uuid())
  user_id        String
  problem_id     String
  code           String
  language       String
  status         SubmissionStatus @default(PENDING)
  execution_time Float?
  created_at     DateTime         @default(now())

  user    User    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  problem Problem @relation(fields: [problem_id], references: [id], onDelete: Cascade)
}

model SuspiciousLog {
  id        String   @id @default(uuid())
  user_id   String
  reason    String
  timestamp DateTime @default(now())

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)
}
